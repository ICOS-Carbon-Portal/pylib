<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>FAQ - ICOS Carbon Portal pylib</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "FAQ";
        var mkdocs_page_input_path = "faq.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> ICOS Carbon Portal pylib
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">About</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../install/">Installation</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../modules/">Modules</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../examples/">Examples</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">FAQ</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#how-can-i-get-an-overview-of-a-digital-objects-metadata">How can I get an overview of a digital object's metadata?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#dobjstation-returns-none-what-am-i-doing-wrong">dobj.station returns None. What am I doing wrong?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#why-cant-i-access-all-files-within-a-collection">Why can't I access all files within a collection?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#how-can-i-retrieve-the-latestnewest-version-of-a-dataset">How can I retrieve the latest/newest version of a dataset?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#how-do-i-suppress-warnings">How do I suppress warnings?</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#good-to-know">Good to Know</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#iteration-over-station_id_df-displays-stationname-as-an-index">Iteration over station_id_df displays station.name as an index</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../changelog/">Changelog</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">ICOS Carbon Portal pylib</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li><li>FAQ</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="_1"></h1>
<p>Things, which have popped up while using this library, and might be of interest.</p>
<h2 id="how-can-i-get-an-overview-of-a-digital-objects-metadata">How can I get an overview of a digital object's metadata?</h2>
<p>You can use the following code, to print all keys from a nested dictionary. The example extracts the station
information associated with the data object. This information is a 'subset' from the metadata 
<code>do.meta['specificInfo']['acquisition']['station']</code> or, yielding the same information, through the convenience property:
<code>do.station</code>.</p>
<pre><code>from icoscp.cpb.dobj import Dobj

dobj = Dobj('j7-Lxlln8_ysi4DEV8qine_v')

def get_keys(dictionary):
    result = []
    for key, value in dictionary.items():
        if type(value) is dict:
            new_keys = get_keys(value)
            result.append(key)
            for innerkey in new_keys:
                result.append(f'{key}/{innerkey}')
        else:
            result.append(key)
    return result

metadata = do.station
keys = get_keys(metadata)
print(keys)
</code></pre>
<p>output of all <strong>keys</strong> for the station metadata:</p>
<p><code>'id',
 'location',
 'location/alt',
 'location/label',
 'location/lat',
 'location/lon',
 'org',
 'org/name',
 'org/self',
 'org/self/comments',
 'org/self/label',
 'org/self/uri',
 'pictures',
 'responsibleOrganization',
 'responsibleOrganization/name',
 'responsibleOrganization/self',
 'responsibleOrganization/self/comments',
 'responsibleOrganization/self/label',
 'responsibleOrganization/self/uri',
 'responsibleOrganization/website',
 'specificInfo',
 'specificInfo/_type',
 'specificInfo/countryCode',
 'specificInfo/discontinued',
 'specificInfo/documentation',
 'specificInfo/labelingDate',
 'specificInfo/stationClass',
 'specificInfo/theme',
 'specificInfo/theme/icon',
 'specificInfo/theme/markerIcon',
 'specificInfo/theme/self',
 'specificInfo/theme/self/comments',
 'specificInfo/theme/self/label',
 'specificInfo/theme/self/uri',
 'specificInfo/timeZoneOffset',
 'specificInfo/wigosId'</code></p>
<h2 id="dobjstation-returns-none-what-am-i-doing-wrong">dobj.station returns None. What am I doing wrong?</h2>
<p>The attribute of dobj.station is set only AFTER you have called dobj.data. Not very intuitive and will be rectified in 
a future release.<br> 
<strong> update </strong> (&gt;=version 0.1.15): The full meta data information about a digital object is available immediately.</p>
<h2 id="why-cant-i-access-all-files-within-a-collection">Why can't I access all files within a collection?</h2>
<p>Collection is loosely assembled and may contain any kind of files and information. For example, it is possible to 
gather pdf documents and NetCDF and some tabular files in a collection. These files will be presented to you, because 
they are within the collection. <strong>BUT</strong> only tabular files (where a preview is available in the data portal) can be 
accessed directly. In other words, you can NOT expect that you can 'load' all files listed in a collection.</p>
<h2 id="how-can-i-retrieve-the-latestnewest-version-of-a-dataset">How can I retrieve the latest/newest version of a dataset?</h2>
<p>Sometimes after loading a dataset, .next might return a PID. Hence, you are not looking at the newest version of the 
data. The following code snippet will loop through the pid, returning the newest version:</p>
<pre><code>from icoscp.cpb.dobj import Dobj
dobj = Dobj('https://meta.icos-cp.eu/objects/lNJPHqvsMuTAh-3DOvJejgYc')

while dobj.valid:
    if dobj.next:
        dobj = Dobj(dobj.next)
    else:
        break
# Now dobj is the newest version.
</code></pre>
<h2 id="how-do-i-suppress-warnings">How do I suppress warnings?</h2>
<p>Internally the <code>icoscp</code> python library uses the <code>warnings</code> module to provide
useful information to the users.</p>
<ul>
<li>
<p><code>future warning</code> messages are connected to components of the library that
    will change in a future release. Here is an example of a <code>future warning</code>
    message:</p>
<pre><code>/pylib/icoscp/cpauth/exceptions.py:28: FutureWarning:
Due to updates in the python library of the ICOS carbon portal, starting from
the next version, user authentication might be required.
warnings.warn(warning, category=FutureWarning)
</code></pre>
<p>To suppress such a message, users need to add the code below in their 
scripts:</p>
<pre><code>import warnings
warnings.simplefilter("ignore", FutureWarning)
</code></pre>
</li>
<li>
<p><code>user warning</code> messages are used to notify the user that there is something 
    potentially incorrect or risky in the program, but that the program is 
    still able to run. Here is an example of a <code>user warning</code> message:</p>
<pre><code>    /pylib/icoscp/cpauth/exceptions.py:39: UserWarning:
    Your authentication was unsuccessful. Falling back to anonymous data access.
    Please, revisit your authentication configuration or have a look at the
    documentation. Authentication will become mandatory for data access.
    warnings.warn(warning, category=UserWarning)
</code></pre>
<p>To suppress such a message, users need to add the code below in their 
scripts:</p>
<pre><code>import warnings
warnings.simplefilter("ignore", UserWarning)
</code></pre>
</li>
</ul>
<h2 id="good-to-know">Good to Know</h2>
<ul>
<li>Stations are associated with the stationID. This means that at the moment a combined station, certified for Ecosystem 
AND Atmosphere, has two different stationId's and hence to access ALL data for such a station you need provide a list of
stationId's to find a complete set of data products. Example Norunda, Sweden (stationId "SE-Nor" for Ecosystem, 
stationId "NOR" for Atmosphere).</li>
</ul>
<h2 id="iteration-over-station_id_df-displays-stationname-as-an-index">Iteration over <code>station_id_df</code> displays <code>station.name</code> as an index</h2>
<p>The dataframe provided by <code>station.getIdList</code> has a column for station names called "name", and <code>pandas.DataFrame</code> has an 
implementation where each column is turned into an attribute. However, an iteration over the rows, like in the below example, will not 
give the station name</p>
<pre><code>from icoscp.station import station
df = station.getIdList(project='all')
for _, row in df.iterrows():
    if row.theme in ['ES', 'FluxnetStation']:
        print(row.name, row.id, row.uri)

0 SE-Sto http://meta.icos-cp.eu/resources/stations/ES_SE-Sto
1 ES-Agu http://meta.icos-cp.eu/resources/stations/FLUXNET_ES-Agu
...
214 GL-ZaF http://meta.icos-cp.eu/resources/stations/ES_GL-ZaF
215 GL-ZaH http://meta.icos-cp.eu/resources/stations/ES_GL-ZaH
</code></pre>
<p>The reason is that each <code>row</code> that is unpacked in the loop is a <code>pandas.Series</code> object, and every <code>Series</code> object has an attribute 
called <code>name</code>, holding the name of the series. In this case the name is the rownumber from the dataframe index.</p>
<p>Examples on how to avoid this.</p>
<ol>
<li>
<p>Use a dictionary-style call instead of a attribute-style call:</p>
<pre><code>...
for _, row in df.iterrows():
    if row.theme in ['ES', 'FluxnetStation']:
        print(row['name'], row.id, row.uri)
</code></pre>
</li>
<li>
<p>Print a subframe and avoid the iteration:</p>
<pre><code>...
df2 = df[df['theme'].isin(['ES', 'FluxnetStation'])]
print(df2[['name', 'id', 'uri']].to_string())
</code></pre>
</li>
<li>
<p>Use the "name"-column as the index:</p>
<pre><code>...
df.set_index('name', inplace=True)
for _, row in df.iterrows():
    if row.theme in ['ES', 'FluxnetStation']:
        print(row.name, row.id, row.uri)
</code></pre>
</li>
<li>
<p>Rename the column "name":</p>
<pre><code>...
df.rename(columns={'name': 'station_name'}, inplace=True)
for _, row in df.iterrows():
    if row.theme in ['ES', 'FluxnetStation']:
        print(row.station_name, row.id, row.uri)
</code></pre>
</li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../examples/" class="btn btn-neutral float-left" title="Examples"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../changelog/" class="btn btn-neutral float-right" title="Changelog">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../examples/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../changelog/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
